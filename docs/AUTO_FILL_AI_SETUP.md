# 商品情報AI自動入力機能 セットアップガイド

このガイドでは、**AI判定機能付き**の商品情報自動入力のセットアップ方法を説明します。

## 📋 概要

この機能を使うと：
1. **商品URLを入力**
2. **メニューから「選択行の商品情報を自動入力（AI判定）」をクリック**
3. **すべての情報が自動で入力される**
   - 商品名・価格（HTMLから抽出）
   - カテゴリ・贈る相手・シーン・予算帯・タグ（AI判定）

### ✅ メリット
- **すべて自動** - カテゴリ・贈る相手・シーンもAIが判定
- **API Key不要** - 外部APIは使用しません
- **セキュア** - GitHub TokenはApps Scriptのプロパティで安全に管理

### ⚠️ 注意事項
- AI判定は100%正確ではありません
- 必ず内容を確認して、必要に応じて修正してください

---

## 🚀 セットアップ手順

### ステップ1: スプレッドシートにO列を追加

1. **Googleスプレッドシートを開く**
   - https://docs.google.com/spreadsheets/d/1ObAaJrRmAtzKM-v81OiS9XpOIxHJVj4B5wvFWkCRyOE/edit

2. **O列に「productUrl」列を追加**（まだの場合）
   - N列（isPublished）の右に新しい列を挿入
   - O1セルに `productUrl` と入力

### ステップ2: Apps Scriptを設定

1. **Apps Scriptエディタを開く**
   - スプレッドシートのメニューから「拡張機能」→「Apps Script」

2. **既存のコードを削除**
   - エディタ内のすべてのコードを削除（`Cmd+A` → `Delete`）

3. **新しいコードを貼り付け**
   - `scripts/auto-fill-ai.js` の内容をすべてコピー
   - Apps Scriptエディタに貼り付け

4. **保存**
   - 💾 保存アイコンをクリック

### ステップ3: GitHub Tokenを設定

**重要**: この方法ならGitHub Tokenが安全に管理され、次回以降も自動で引き継がれます。

#### 方法1: メニューから設定（推奨）

1. **スプレッドシートに戻る**
   - ページをリロード（`Cmd+R`）

2. **メニューから設定**
   - 「商品管理」→「GitHub Tokenを設定」
   - ダイアログにトークンを貼り付け
   - 「OK」をクリック

#### 方法2: スクリプトプロパティから設定

1. **Apps Scriptエディタで設定**
   - Apps Scriptエディタの左側メニューから「プロジェクトの設定」（⚙アイコン）
   - 下にスクロールして「スクリプトプロパティ」セクション
   - 「スクリプトプロパティを追加」をクリック

2. **プロパティを追加**
   - プロパティ: `GITHUB_TOKEN`
   - 値: `YOUR_GITHUB_PERSONAL_ACCESS_TOKEN`（あなたのトークン）
   - 「スクリプトプロパティを保存」をクリック

### ステップ4: 権限を承認

1. **スプレッドシートに戻る**
   - ページをリロード（`Cmd+R`）

2. **メニューを確認**
   - 「商品管理」メニューが追加されているはず

3. **初回実行**
   - 「商品管理」→「選択行の商品情報を自動入力（AI判定）」
   - 権限承認画面が表示されたら承認

---

## 📝 使い方

### 方法1: 1行ずつ自動入力

1. **O列に商品URLを入力**
   ```
   例: https://www.ayura.co.jp/products/item/73009/
   例: https://www.amazon.co.jp/dp/B0DJMMJSPZ
   ```

2. **その行を選択**
   - 行番号をクリック

3. **メニューから自動入力**
   - 「商品管理」→「選択行の商品情報を自動入力（AI判定）」

4. **結果を確認**
   - 全情報が自動入力されます
   - **必ず内容を確認して、必要に応じて修正してください**

### 方法2: 一括自動入力

1. **複数の商品URLを入力**
   - O列に複数の商品URLを貼り付け

2. **一括実行**
   - 「商品管理」→「空欄の商品情報を一括自動入力（AI判定）」

3. **待機**
   - 1件ずつ処理されます（AI判定のため2秒間隔）

---

## ✅ 自動入力される情報

| 列 | 内容 | 自動入力方法 |
|---|------|-------------|
| **id** | 商品ID | ✅ 自動採番（prod_016, prod_017...） |
| **name** | 商品名 | ✅ HTMLから抽出 |
| **description** | 商品説明 | ✅ 商品名を使用 |
| **price** | 価格 | ✅ HTMLから抽出 |
| **imageUrl** | 画像URL | ✅ 仮の値を設定 |
| **category** | カテゴリ | ✅ **AI判定** |
| **recipients** | 贈る相手 | ✅ **AI判定** |
| **occasions** | シーン | ✅ **AI判定** |
| **budgetRange** | 予算帯 | ✅ **AI判定**（価格から自動計算） |
| **amazonUrl** | Amazon URL | ✅ URLがAmazonの場合のみ |
| **rakutenUrl** | 楽天 URL | ✅ URLが楽天の場合のみ |
| **tags** | タグ | ✅ **AI判定** |
| **priority** | 優先度 | ✅ **AI判定**（カテゴリ・価格から自動計算） |
| **isPublished** | 公開状態 | ✅ デフォルト値 `TRUE` |

---

## 🤖 AI判定の仕組み

### カテゴリ判定

商品名から以下のキーワードで判定：
- **コスメ**: 化粧、コスメ、クリーム、香水、アロマ、入浴
- **グルメ**: チョコ、スイーツ、お菓子、酒、ワイン、日本酒
- **ガジェット**: 時計、イヤホン、スマート、ガジェット
- **花・植物**: 花、フラワー、植物
- **ファッション**: 財布、ネクタイ、バッグ
- **インテリア**: インテリア、家具
- **体験**: ディナー、体験
- **雑貨**: その他

### 贈る相手の判定

カテゴリと価格から自動判定：
- **コスメ・花**: 彼女、妻、母、友人女性
- **ガジェット・財布・ネクタイ**: 彼氏、夫、父、上司、友人男性
- **その他**: 幅広く設定

### シーン判定

価格とカテゴリから自動判定：
- **5,000円以上**: 誕生日、クリスマス、記念日
- **5,000円未満**: 誕生日、お礼
- **コスメ・花**: 母の日、ホワイトデー
- **グルメ**: お中元、お歳暮

### 予算帯

価格から自動計算：
- ~3,000円
- 3,000~5,000円
- 5,000~10,000円
- 10,000~20,000円
- 20,000~30,000円
- 30,000円~

### タグ

カテゴリ + キーワード抽出：
- カテゴリ名
- 価格帯（プチギフト / 高級）
- 商品名から最大3つのキーワード

### 優先度

デフォルト80点 + カテゴリ・価格で加点：
- 10,000円以上: +5点
- コスメ・ガジェット: +5点

---

## 💡 ワークフロー例

### 新しい商品を10件追加する場合

1. **スプレッドシートを開く**

2. **O列に10個の商品URLを貼り付け**
   ```
   https://www.ayura.co.jp/products/item/73009/
   https://www.amazon.co.jp/dp/B0DJMMJSPZ
   https://rakuten.co.jp/...
   ...
   ```

3. **「空欄の商品情報を一括自動入力（AI判定）」をクリック**

4. **20秒ほど待つ**（2秒×10件）

5. **自動入力された内容を確認・微調整**
   - カテゴリが正しいか確認
   - 贈る相手が適切か確認
   - シーンが妥当か確認

6. **「GitHubにプッシュ」をクリック**

7. **ローカルで反映**
   ```bash
   cd /Users/yasuko/Documents/local/gift-diagnosis
   git pull origin main
   python3 scripts/csv_to_json.py
   git add src/data/products.json
   git commit -m "商品を10件追加"
   git push origin main
   ```

これで完了です！

---

## 🔧 GitHub Token管理の仕組み

### なぜスクリプトプロパティを使うのか？

1. **セキュア**: トークンがコードに含まれない
2. **自動引き継ぎ**: 一度設定すれば次回以降も有効
3. **GitHubにプッシュしても安全**: トークンはGitHubに公開されない

### トークンの確認方法

「商品管理」→「設定を確認」で現在の設定を確認できます。

### トークンを変更したい場合

1. **メニューから変更**
   - 「商品管理」→「GitHub Tokenを設定」

2. **または、スクリプトプロパティから変更**
   - Apps Scriptエディタ →「プロジェクトの設定」→「スクリプトプロパティ」
   - `GITHUB_TOKEN`の値を編集

---

## ⚠️ トラブルシューティング

### 「シートオブジェクトが無効です」エラー

**原因**: スプレッドシートが正しく開かれていない

**解決策**:
- スプレッドシートをリロード（`Cmd+R`）
- 再度メニューから実行

### AI判定が不正確

**原因**: 商品名からの判定には限界があります

**解決策**:
- 自動入力後、必ず内容を確認
- 不正確な部分は手動で修正

### GitHub Tokenが設定できない

**原因**: トークンの入力ミスまたは権限不足

**解決策**:
1. トークンが正しいか確認（`ghp_`で始まる）
2. トークンに`repo`スコープがあるか確認
3. 新しいトークンを作成して再設定

---

## 📚 参考リンク

- [スプレッドシート管理ガイド](./SPREADSHEET_MANAGEMENT.md)
- [Google Apps Script セットアップ](./GOOGLE_APPS_SCRIPT_SETUP.md)
- [Google Apps Script 公式ドキュメント](https://developers.google.com/apps-script)

---

## 🎯 簡易版との比較

| 項目 | 簡易版 | AI判定版（このガイド） |
|------|--------|----------------------|
| **商品名** | ✅ 自動 | ✅ 自動 |
| **価格** | ✅ 自動 | ✅ 自動 |
| **カテゴリ** | ❌ 手動 | ✅ AI判定 |
| **贈る相手** | ❌ 手動 | ✅ AI判定 |
| **シーン** | ❌ 手動 | ✅ AI判定 |
| **予算帯** | ❌ 手動 | ✅ AI判定 |
| **タグ** | ❌ 手動 | ✅ AI判定 |
| **設定** | やや複雑 | 簡単（メニューから設定） |
| **Token管理** | コードに直接 | スクリプトプロパティ（安全） |

**推奨**: AI判定版（このガイド）の使用を推奨します！
